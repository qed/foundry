# The Hall (Phases 011–025)

> Idea management module: schema, layout, CRUD, tags, search, filters, detail view, edit/delete, agent chat, realtime updates, bulk operations, promotion to Shop, AI agents.
> Key files: `components/hall/`, `app/api/hall/`, `app/api/agent/hall/`, `lib/agent/context.ts`, `lib/realtime/`

**011** — Hall Database Schema — SQL migration 003_hall_schema.sql creating 5 tables: ideas with status tracking raw/developing/mature/promoted/archived + project scoping + audit fields + promoted_to_seed_id nullable UUID, tags with project-scoped custom colors + unique name constraint, idea_tags junction table, idea_connections for related/duplicates/extends relationships, agent_conversations with JSONB messages; RLS policies on all 5 tables using existing is_project_member() SECURITY DEFINER helper; new idea_project_member() SECURITY DEFINER function for indirect project membership checks on junction tables; 10 indexes; auto-update triggers on ideas.updated_at and agent_conversations.updated_at; updated TypeScript types with full Row/Insert/Update definitions and convenience aliases Idea/Tag/IdeaTag/IdeaConnection/AgentConversation/IdeaStatus.

**012** — Hall Page Layout & UI — replaced Hall placeholder with full interactive page: HallClient orchestrator manages URL state for view/search/status/sort via useSearchParams + useRouter.replace, HallHeader with title/icon/subtitle/search input/New Idea button/Grid-List view toggle, HallEmptyState with lightbulb icon and CTA, IdeaCard with status badge/title-body preview/colored tag chips/creator avatar/relative timestamp, IdeaGrid with responsive 3/2/1 column layout and skeleton loading, IdeaList with select-all checkbox/column headers/compact rows/responsive column hiding, FilterBar with status dropdown/sort dropdown/active filter chips/clear all, ViewToggle with Grid/List icons, mobile FAB for New Idea above bottom nav, server component data fetching enriching ideas with tags and creator profiles, loading.tsx skeleton, shared types IdeaWithDetails/STATUS_CONFIG/STATUS_OPTIONS/SORT_OPTIONS, timeAgo utility in lib/utils.ts.

**013** — Create Idea / Note Capture — IdeaCreateModal with title input (required, 200 char limit with live counter, autofocus), description textarea (optional, 3000 char limit with live counter, resizable), tag selection with search/filter existing project tags plus inline tag creation with custom color picker, client-side validation with error messages, submit button disabled until title has content with loading spinner, cancel with dirty-form discard confirmation, overlay click and Escape key dismiss, desktop centered 600px modal / mobile full-screen, success/error toasts via ToastProvider, POST /api/hall/ideas endpoint with server-side validation + project membership check + tag verification + new tag creation + full idea+tags+creator response, GET /api/hall/tags endpoint for fetching project tags, HallClient wired to router.refresh() on idea creation, useOptionalAuth hook fix for UserMenu HMR resilience.

**014** — Idea List View — GET /api/hall/ideas endpoint with pagination (limit/offset), sorting (newest/oldest/updated/A-Z/Z-A), search (title+body ilike), status filtering, project membership validation, batch tag+profile enrichment, total count + hasMore flag; LoadMoreTrigger component with IntersectionObserver for auto-loading next page on scroll; NoResultsState component with SearchX icon and clear filters button; HallClient rewritten from client-side-only filtering to hybrid server+client pagination with initial 12 ideas from server component then API-based infinite scroll on scroll/filter/sort changes with 300ms search debounce and AbortController race condition handling; Hall page server component fetches only first 12 ideas + total count; alphabetical sort options A-Z and Z-A; loading states with opacity dimming + spinner during refetch, spinner during infinite scroll, "All N ideas loaded" end-of-list message.

**015** — Hall Search & Filter — tag filter dropdown in FilterBar with multi-select checkboxes, search-within-tags input, Select all / Deselect all controls, AND-logic tag filtering; search clear (X) button in HallHeader search input; active filter chip bar below filter controls with removable chips for search term, status, and each selected tag with color dots; Clear all button resets search/status/tags/sort; filtered result count "N ideas found"; tag selections stored in URL as ?tags=uuid1,uuid2 for shareable bookmarkable filter states; GET /api/hall/ideas updated with tags param and server-side AND-logic filtering via idea_tags junction table; project tags fetched server-side and passed as initialTags to HallClient; all filters composable with URL state management.

**016** — Idea Detail Slide-Over — slide-over panel from right edge on idea card click with 300ms animation, 600px desktop / 500px tablet / full-width mobile, overlay click-to-close + Escape key + body scroll lock; full idea display with status badge, creator avatar/name/timestamps, full body text, colored clickable tag pills that filter Hall on click, Related Ideas section with connection type badges and click-to-navigate between connected ideas, Idea Info panel with metadata grid; action buttons Edit/Archive/Promote as UI placeholders for future phases; Archive confirmation dialog; loading spinner + error retry state; GET /api/hall/ideas/[ideaId] endpoint with tags + creator + membership validation; GET /api/hall/ideas/[ideaId]/connections endpoint with bidirectional connection fetching + enriched details; onIdeaClick wired into IdeaGrid and IdeaList; HallClient manages selectedIdeaId state.

**017** — Edit & Delete Ideas — PUT /api/hall/ideas/[ideaId] for inline editing with field-level updates supporting title/body/status changes, DELETE /api/hall/ideas/[ideaId] for soft-delete setting deleted_at timestamp, POST /api/hall/ideas/[ideaId]/undelete for undo within toast window restoring deleted_at to null; idea-edit-form.tsx with auto-save on blur and debounced title editing with 500ms delay; idea-action-buttons.tsx wired with Edit pencil icon and Archive trash icon actions; idea-detail-slide-over.tsx with edit mode toggle switching between view and inline edit; hall-client.tsx with optimistic update/archive handlers providing instant UI feedback and undo toast with 5-second window; toast system enhanced with action button support enabling undo capability on destructive operations.

**018** — Tagging & Tag Management — tag management page at /hall/tags with search, sort by name/usage/newest, responsive glass-panel card grid; create tag modal with name input max 30 chars unique-per-project validation, 8-color preset palette plus custom hex input with live tag preview; edit tag modal with pre-populated values and in-use warning showing affected idea count; delete tag confirmation with usage count display, option to merge into another tag reassigning all ideas or remove from all ideas; POST /api/hall/tags for standalone tag creation with duplicate checking, PUT /api/hall/tags/[tagId] for name and color updates, DELETE /api/hall/tags/[tagId] with cascade removal from idea_tags, POST /api/hall/tags/[tagId]/merge to reassign ideas to target tag then delete source; GET /api/hall/tags enhanced with includeUsage=true parameter for usage counts via idea_tags aggregation; Manage Tags link added to Hall header navigation; idea create modal autocomplete enhanced to show per-tag usage counts; ColorPicker component with preset swatches and hex input; EmptyState with Tags icon and create CTA.

**019** — Bulk Operations — selection checkboxes on IdeaCard grid view with isSelected/onSelect props and cyan border highlight; BulkActionBar floating at bottom center with selection count badge, Tag/Status/Archive action buttons and Deselect X button using glass-panel styling with slide-in animation; BulkTagModal with searchable checkbox tag list applying tags as union operation preserving existing; BulkStatusModal with radio-style status picker for raw/developing/mature with Badge previews; BulkDeleteModal with AlertTriangle confirmation dialog; 4 API routes: POST /api/hall/bulk/tag adding tags to multiple ideas skipping duplicates via existingSet lookup, PUT /api/hall/bulk/status changing status for multiple ideas filtering out promoted/archived, POST /api/hall/bulk/archive soft-deleting multiple ideas returning previousStatuses for undo, POST /api/hall/bulk/unarchive restoring archived ideas to previous statuses; optimistic removal on bulk archive with undo toast; refetch after all bulk operations to sync changes; IdeaGrid updated with selectedIds/onSelectionChange props; all modals use Dialog with open/onOpenChange pattern.

**020** — Hall Agent Infrastructure — AI-powered chat panel in The Hall using Anthropic Claude API with streaming responses; agent-panel.tsx as collapsible right sidebar with conversation history loading and persistence via agent_conversations table; agent-message.tsx with user/assistant chat bubbles in dark theme with purple Bot icon and cyan User icon; agent-input.tsx with auto-resizing textarea and Enter-to-send; POST /api/agent/hall/chat streaming endpoint calling Claude Haiku with project idea context injection including titles, bodies, statuses, and tags; GET/PUT /api/agent/hall for conversation history load and save; lib/agent/context.ts with buildHallContext assembling idea portfolio summary and buildSystemPrompt combining role description with live context; system prompt guiding agent to analyze ideas for tags, duplicates, connections, and refinement; context window management keeping last 20 messages; typing indicator with animated dots; error handling with graceful fallback messages; Escape to close panel; mobile full-width with overlay; purple FAB toggle button; @anthropic-ai/sdk dependency added.

**021** — Agent: Auto-Tag Suggestions — [No description found in Phase History paragraph. Listed as completed in Section 6: "Phase 021: Agent: Auto-Tag Suggestions (Hall) -- done". Description not yet appended to the phase history.]

**022** — Agent: Duplicate Detection — [No description found in Phase History paragraph. Listed as completed in Section 6: "Phase 022: Agent: Duplicate Detection (Hall) -- done". Description not yet appended to the phase history.]

**023** — Agent: Connection Discovery — [No description found in Phase History paragraph. Listed as completed in Section 6: "Phase 023: Agent: Connection Discovery (Hall) -- done". Description not yet appended to the phase history.]

**024** — Hall Real-Time Updates — useRealtimeIdeas hook in lib/realtime/use-realtime-ideas.ts subscribing to Supabase postgres_changes on ideas table filtered by project_id for INSERT/UPDATE/DELETE events with stable ref pattern for onChange callback; ConnectionStatus component with green/red dot indicator and Synced/Offline text; real-time event handling wired into hall-client.tsx state: INSERT adds new idea stub to top of list with slide-in animation incrementing total count and deduplication check, UPDATE merges changed fields preserving client-side tags and creator relations with yellow highlight flash, DELETE removes idea from list decrementing total count; CSS keyframe animations in globals.css: highlight-flash with amber box-shadow fade-out over 1s, slide-in with opacity/translateY 300ms ease-out; highlightedIds and newIds Set state with auto-clear timers after 1s cleanup; IdeaGrid and IdeaList updated to accept highlightedIds/newIds props passing through to IdeaCard highlighted prop and IdeaListRow highlighted/isNew props; ConnectionStatus displayed next to Hall header; highlight timer cleanup on unmount via useEffect.

**025** — Hall to Pattern Shop Promotion — SQL migration 013_hall_promotion_schema.sql adding hall_idea_id UUID column to feature_nodes with FK to ideas and filtered index; POST /api/hall/ideas/[ideaId]/promote endpoint validating promotable statuses raw/developing/mature, creating feature_node seed at root level with auto-positioned ordering and hall_idea_id backlink, updating idea status to promoted with promoted_to_seed_id FK to created seed; PromotionWizard 4-step modal component: Step 1 confirms idea details showing title/body/tags with maturity warning hints for raw/developing status, Step 2 selects seed level epic or feature with inferSeedLevel heuristic based on body length and broad-scope keywords, Step 3 edits seed name/description pre-filled from idea with level badge, Step 4 shows success with link to Pattern Shop; IdeaActionButtons updated from disabled placeholder to functional Promote button, promoted banner with View Seed external link shown for promoted ideas, Edit/Archive hidden for promoted status; IdeaDetailSlideOver wired with PromotionWizard opening on promote click and refetching idea after promotion; orgSlug prop threaded through slide-over for promotion links; TypeScript types updated with hall_idea_id on feature_nodes Row/Insert/Update.
