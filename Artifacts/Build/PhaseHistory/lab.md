# Insights Lab (Phases 081–085)

> Feedback collection and analysis module: schema, layout, inbox display with sorting/pagination, detail view.
> Key files: `components/lab/`, `app/api/projects/[projectId]/feedback/`, `app/api/projects/[projectId]/app-keys/`

**081** — Insights Lab Database Schema — SQL migration 006_insights_lab_schema.sql creating 2 tables: app_keys for project-scoped API keys with active/revoked status and unique key_value constraint for external feedback collection authentication, feedback_submissions with content text and category classification bug/feature_request/ux_issue/performance/other/uncategorized plus new/triaged/converted/archived status tracking and optional AI priority score 0-100, text array tags, JSONB metadata for browser/device/page_url/user_agent, conversion tracking via converted_to_work_order_id FK to work_orders and converted_to_feature_id FK to feature_nodes, nullable submitter_email and submitter_name; RLS policies using is_project_member() for tenant isolation plus special insert policy allowing external submissions with valid app keys via is_active_app_key() SECURITY DEFINER helper; 7 indexes including composite project+created_at DESC for inbox listing, project+status for filtering, project+score DESC NULLS LAST for prioritization; auto-update trigger on feedback_submissions.updated_at; updated TypeScript types with full Row/Insert/Update definitions and convenience aliases AppKey/FeedbackSubmission/AppKeyStatus/FeedbackCategory/FeedbackStatus.

**083** — Insights Lab Page Layout — two-panel layout with LabClient orchestrator managing feedback inbox 40% width and detail panel 60% width; LabHeader with module icon, color-coded stat badges for Total/New/Triaged/Converted feedback counts, refresh button with spin animation, agent panel toggle with accent-purple active state; LabInbox showing feedback list with content preview line-clamp-2, status dots cyan/warning/success/tertiary for new/triaged/converted/archived, category badges with color coding bug-error/feature_request-purple/ux_issue-warning/performance-cyan, submitter name, timeAgo timestamps, selected state with accent-cyan border; LabDetailPanel with status and category badges, full content with whitespace-pre-wrap, tags as rounded pills, submitter metadata, placeholder conversion action buttons for Phase 088/089; LabAgentPanel as fixed overlay sidebar with slide-in translate-x transition, backdrop overlay with click-to-close, X close button, disabled chat input for Phase 090; GET /api/projects/[projectId]/feedback endpoint with status/category/search filters using typed FeedbackStatus/FeedbackCategory casting for Supabase queries; server component fetches feedback status counts for initial render stats; responsive with detail panel hidden on mobile.

**084** — Feedback Inbox Display — enhanced inbox list view with sorting, pagination, and priority scoring; GET /feedback API updated with sort parameter supporting newest/oldest/highest_score, limit/offset pagination with total count via Supabase count:'exact', secondary sort on created_at for score ties; LabInbox component enhanced with FeedbackInboxHeader section showing total count badge and sort dropdown with 3 options, FeedbackInboxItem extracted component with status dot pulse animation via animate-ping for new items, category badge with color coding, priority score display with Gauge icon, submitter name/email fallback, relative timestamps with full date hover tooltips; InboxPagination section with prev/next buttons and current page indicator at 20 items per page; LabClient updated with sort and page state management, PAGE_SIZE constant, query parameter construction for API calls, handleSortChange resetting page to 1; FeedbackSort type exported from lab-inbox for cross-component use.

**085** — Feedback Detail View — completed (no detailed description recorded in the phase history paragraph).
